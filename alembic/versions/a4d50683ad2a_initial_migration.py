"""initial_migration

Revision ID: a4d50683ad2a
Revises: 000000000001
Create Date: 2026-01-27 20:33:39.664209

"""

from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
import sqlmodel
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = "a4d50683ad2a"
down_revision: Union[str, Sequence[str], None] = "000000000001"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # Get current connection for direct execution
    connection = op.get_bind()

    # Create sequence for professional version numbers
    connection.execute(
        sa.text("CREATE SEQUENCE IF NOT EXISTS professional_version_number_seq")
    )

    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "banks",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("code", sqlmodel.sql.sqltypes.AutoString(length=10), nullable=False),
        sa.Column(
            "ispb_code", sqlmodel.sql.sqltypes.AutoString(length=8), nullable=True
        ),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
        sa.Column(
            "short_name", sqlmodel.sql.sqltypes.AutoString(length=50), nullable=True
        ),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("code", name="uq_banks_code"),
        sa.UniqueConstraint("ispb_code", name="uq_banks_ispb_code"),
    )
    op.create_table(
        "permissions",
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("code", sqlmodel.sql.sqltypes.AutoString(length=100), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column(
            "module", sqlmodel.sql.sqltypes.AutoString(length=50), nullable=False
        ),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default="now()",
            nullable=False,
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("code", name="uq_permissions_code"),
    )
    op.create_table(
        "roles",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("code", sqlmodel.sql.sqltypes.AutoString(length=50), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(length=100), nullable=False),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("is_system", sa.Boolean(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("code", name="uq_roles_code"),
    )
    op.create_table(
        "specialties",
        sa.Column("deleted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("code", sqlmodel.sql.sqltypes.AutoString(length=50), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(length=150), nullable=False),
        sa.Column("description", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        "idx_specialties_name",
        "specialties",
        ["name"],
        unique=False,
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    # GIN trigram index needs raw SQL for proper operator class
    connection.execute(
        sa.text("""
        CREATE INDEX idx_specialties_search_trgm ON specialties
        USING gin ((COALESCE(lower(code), '') || ' ' || COALESCE(f_unaccent(lower(name)), '')) gin_trgm_ops)
        WHERE deleted_at IS NULL
    """)
    )
    op.create_index(
        "uq_specialties_code",
        "specialties",
        ["code"],
        unique=True,
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.create_table(
        "users",
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column(
            "firebase_uid", sqlmodel.sql.sqltypes.AutoString(length=128), nullable=False
        ),
        sa.Column(
            "email", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False
        ),
        sa.Column(
            "full_name", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False
        ),
        sa.Column("phone", sqlmodel.sql.sqltypes.AutoString(length=20), nullable=True),
        sa.Column("cpf", sqlmodel.sql.sqltypes.AutoString(length=11), nullable=True),
        sa.Column(
            "avatar_url", sqlmodel.sql.sqltypes.AutoString(length=500), nullable=True
        ),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("email_verified_at", sa.DateTime(timezone=True), nullable=True),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("cpf", name="uq_users_cpf"),
        sa.UniqueConstraint("email", name="uq_users_email"),
        sa.UniqueConstraint("firebase_uid", name="uq_users_firebase_uid"),
    )
    op.create_table(
        "companies",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column("verified_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("verified_by", sa.Uuid(), nullable=True),
        sa.Column(
            "address", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True
        ),
        sa.Column("number", sqlmodel.sql.sqltypes.AutoString(length=20), nullable=True),
        sa.Column(
            "complement", sqlmodel.sql.sqltypes.AutoString(length=100), nullable=True
        ),
        sa.Column(
            "neighborhood", sqlmodel.sql.sqltypes.AutoString(length=100), nullable=True
        ),
        sa.Column("city", sqlmodel.sql.sqltypes.AutoString(length=100), nullable=True),
        sa.Column(
            "state_code", sqlmodel.sql.sqltypes.AutoString(length=2), nullable=True
        ),
        sa.Column(
            "postal_code", sqlmodel.sql.sqltypes.AutoString(length=10), nullable=True
        ),
        sa.Column("latitude", sa.Float(), nullable=True),
        sa.Column("longitude", sa.Float(), nullable=True),
        sa.Column("cnpj", sqlmodel.sql.sqltypes.AutoString(length=14), nullable=False),
        sa.Column(
            "legal_name", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False
        ),
        sa.Column(
            "trade_name", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True
        ),
        sa.Column(
            "state_registration",
            sqlmodel.sql.sqltypes.AutoString(length=30),
            nullable=True,
        ),
        sa.Column(
            "municipal_registration",
            sqlmodel.sql.sqltypes.AutoString(length=30),
            nullable=True,
        ),
        sa.Column("email", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True),
        sa.Column("phone", sqlmodel.sql.sqltypes.AutoString(length=20), nullable=True),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.ForeignKeyConstraint(
            ["verified_by"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("cnpj", name="uq_companies_cnpj"),
    )
    op.create_table(
        "role_permissions",
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("role_id", sa.Uuid(), nullable=False),
        sa.Column("permission_id", sa.Uuid(), nullable=False),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default="now()",
            nullable=False,
        ),
        sa.ForeignKeyConstraint(
            ["permission_id"],
            ["permissions.id"],
        ),
        sa.ForeignKeyConstraint(
            ["role_id"],
            ["roles.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "role_id", "permission_id", name="uq_role_permissions_role_permission"
        ),
    )
    op.create_table(
        "user_permissions",
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("user_id", sa.Uuid(), nullable=False),
        sa.Column("permission_id", sa.Uuid(), nullable=False),
        sa.Column("granted_by", sa.Uuid(), nullable=True),
        sa.Column(
            "granted_at",
            sa.DateTime(timezone=True),
            server_default="now()",
            nullable=False,
        ),
        sa.Column("expires_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["granted_by"],
            ["users.id"],
        ),
        sa.ForeignKeyConstraint(
            ["permission_id"],
            ["permissions.id"],
        ),
        sa.ForeignKeyConstraint(
            ["user_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "user_id", "permission_id", name="uq_user_permissions_user_permission"
        ),
    )
    op.create_table(
        "user_roles",
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("user_id", sa.Uuid(), nullable=False),
        sa.Column("role_id", sa.Uuid(), nullable=False),
        sa.Column("granted_by", sa.Uuid(), nullable=True),
        sa.Column(
            "granted_at",
            sa.DateTime(timezone=True),
            server_default="now()",
            nullable=False,
        ),
        sa.Column("expires_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["granted_by"],
            ["users.id"],
        ),
        sa.ForeignKeyConstraint(
            ["role_id"],
            ["roles.id"],
        ),
        sa.ForeignKeyConstraint(
            ["user_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("user_id", "role_id", name="uq_user_roles_user_role"),
    )
    op.create_table(
        "organizations",
        sa.Column("deleted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
        sa.Column(
            "organization_type",
            sa.Enum(
                "HOSPITAL",
                "CLINIC",
                "LABORATORY",
                "EMERGENCY_UNIT",
                "HEALTH_CENTER",
                "HOME_CARE",
                "OUTSOURCING_COMPANY",
                "OTHER",
                name="organization_type",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("parent_id", sa.Uuid(), nullable=True),
        sa.Column("company_id", sa.Uuid(), nullable=False),
        sa.ForeignKeyConstraint(
            ["company_id"],
            ["companies.id"],
        ),
        sa.ForeignKeyConstraint(
            ["parent_id"],
            ["organizations.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "client_contracts",
        sa.Column("deleted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column(
            "client_name", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False
        ),
        sa.Column(
            "contract_number",
            sqlmodel.sql.sqltypes.AutoString(length=100),
            nullable=True,
        ),
        sa.Column(
            "description", sqlmodel.sql.sqltypes.AutoString(length=2000), nullable=True
        ),
        sa.Column(
            "status",
            sa.Enum(
                "DRAFT",
                "PENDING_SIGNATURES",
                "ACTIVE",
                "SUSPENDED",
                "TERMINATED",
                "EXPIRED",
                name="contract_status",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("organization_id", sa.Uuid(), nullable=False),
        sa.ForeignKeyConstraint(
            ["organization_id"],
            ["organizations.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        "ix_client_contracts_organization_id",
        "client_contracts",
        ["organization_id"],
        unique=False,
    )
    op.create_index(
        "ix_client_contracts_status", "client_contracts", ["status"], unique=False
    )
    op.create_index(
        "uq_client_contracts_org_number",
        "client_contracts",
        ["organization_id", "contract_number"],
        unique=True,
        postgresql_where="contract_number IS NOT NULL AND deleted_at IS NULL",
    )
    op.create_table(
        "document_type_configs",
        sa.Column("deleted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column("code", sqlmodel.sql.sqltypes.AutoString(length=50), nullable=False),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
        sa.Column(
            "category",
            sa.Enum("PROFILE", "QUALIFICATION", "SPECIALTY", name="documentcategory"),
            nullable=False,
        ),
        sa.Column(
            "description", sqlmodel.sql.sqltypes.AutoString(length=500), nullable=True
        ),
        sa.Column("help_text", sa.Text(), nullable=True),
        sa.Column("validation_instructions", sa.Text(), nullable=True),
        sa.Column(
            "validation_url",
            sqlmodel.sql.sqltypes.AutoString(length=500),
            nullable=True,
        ),
        sa.Column("requires_expiration", sa.Boolean(), nullable=False),
        sa.Column("default_validity_days", sa.Integer(), nullable=True),
        sa.Column(
            "required_for_professional_types",
            postgresql.JSONB(astext_type=sa.Text()),
            nullable=True,
        ),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("display_order", sa.Integer(), nullable=False),
        sa.Column("organization_id", sa.Uuid(), nullable=True),
        sa.ForeignKeyConstraint(
            ["organization_id"],
            ["organizations.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("code", name="uq_document_type_configs_code"),
    )
    op.create_index(
        "ix_document_type_configs_category",
        "document_type_configs",
        ["category"],
        unique=False,
    )
    op.create_index(
        "ix_document_type_configs_code_active",
        "document_type_configs",
        ["code"],
        unique=True,
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.create_index(
        "ix_document_type_configs_is_active",
        "document_type_configs",
        ["is_active"],
        unique=False,
    )
    op.create_table(
        "organization_memberships",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column("invited_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("accepted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "granted_at",
            sa.DateTime(timezone=True),
            server_default="now()",
            nullable=False,
        ),
        sa.Column("expires_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("user_id", sa.Uuid(), nullable=False),
        sa.Column("organization_id", sa.Uuid(), nullable=False),
        sa.Column("role_id", sa.Uuid(), nullable=False),
        sa.Column("granted_by", sa.Uuid(), nullable=True),
        sa.ForeignKeyConstraint(
            ["granted_by"],
            ["users.id"],
        ),
        sa.ForeignKeyConstraint(
            ["organization_id"],
            ["organizations.id"],
        ),
        sa.ForeignKeyConstraint(
            ["role_id"],
            ["roles.id"],
        ),
        sa.ForeignKeyConstraint(
            ["user_id"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "user_id",
            "organization_id",
            "role_id",
            name="uq_org_memberships_user_org_role",
        ),
    )
    op.create_table(
        "organization_professionals",
        sa.Column("deleted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column("verified_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("verified_by", sa.Uuid(), nullable=True),
        sa.Column(
            "address", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True
        ),
        sa.Column("number", sqlmodel.sql.sqltypes.AutoString(length=20), nullable=True),
        sa.Column(
            "complement", sqlmodel.sql.sqltypes.AutoString(length=100), nullable=True
        ),
        sa.Column(
            "neighborhood", sqlmodel.sql.sqltypes.AutoString(length=100), nullable=True
        ),
        sa.Column("city", sqlmodel.sql.sqltypes.AutoString(length=100), nullable=True),
        sa.Column(
            "state_code", sqlmodel.sql.sqltypes.AutoString(length=2), nullable=True
        ),
        sa.Column(
            "postal_code", sqlmodel.sql.sqltypes.AutoString(length=10), nullable=True
        ),
        sa.Column("latitude", sa.Float(), nullable=True),
        sa.Column("longitude", sa.Float(), nullable=True),
        sa.Column(
            "full_name", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False
        ),
        sa.Column("email", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True),
        sa.Column("phone", sqlmodel.sql.sqltypes.AutoString(length=20), nullable=True),
        sa.Column("cpf", sqlmodel.sql.sqltypes.AutoString(length=11), nullable=True),
        sa.Column("birth_date", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column(
            "nationality", sqlmodel.sql.sqltypes.AutoString(length=100), nullable=True
        ),
        sa.Column(
            "gender",
            sa.Enum("MALE", "FEMALE", name="gender", create_constraint=True),
            nullable=True,
        ),
        sa.Column(
            "marital_status",
            sa.Enum(
                "SINGLE",
                "MARRIED",
                "DIVORCED",
                "WIDOWED",
                "SEPARATED",
                "CIVIL_UNION",
                name="marital_status",
                create_constraint=True,
            ),
            nullable=True,
        ),
        sa.Column(
            "avatar_url", sqlmodel.sql.sqltypes.AutoString(length=2048), nullable=True
        ),
        sa.Column("organization_id", sa.Uuid(), nullable=False),
        sa.ForeignKeyConstraint(
            ["organization_id"],
            ["organizations.id"],
        ),
        sa.ForeignKeyConstraint(
            ["verified_by"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        "idx_organization_professionals_created_at",
        "organization_professionals",
        ["created_at"],
        unique=False,
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    # GIN trigram indexes need raw SQL for proper operator class
    connection.execute(
        sa.text("""
        CREATE INDEX idx_organization_professionals_full_name_trgm ON organization_professionals
        USING gin (f_unaccent(lower(full_name)) gin_trgm_ops)
        WHERE deleted_at IS NULL
    """)
    )
    connection.execute(
        sa.text("""
        CREATE INDEX idx_organization_professionals_search_trgm ON organization_professionals
        USING gin ((COALESCE(f_unaccent(lower(full_name)), '') || ' ' || COALESCE(f_unaccent(lower(email)), '') || ' ' || COALESCE(cpf, '')) gin_trgm_ops)
        WHERE deleted_at IS NULL
    """)
    )
    op.create_index(
        "uq_organization_professionals_org_cpf",
        "organization_professionals",
        ["organization_id", "cpf"],
        unique=True,
        postgresql_where=sa.text("cpf IS NOT NULL AND deleted_at IS NULL"),
    )
    op.create_index(
        "uq_organization_professionals_org_email",
        "organization_professionals",
        ["organization_id", "email"],
        unique=True,
        postgresql_where=sa.text("email IS NOT NULL AND deleted_at IS NULL"),
    )
    op.create_table(
        "organization_screening_settings",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column("version", sa.Integer(), server_default="1", nullable=False),
        sa.Column("requires_client_company", sa.Boolean(), nullable=False),
        sa.Column("requires_client_validation_step", sa.Boolean(), nullable=False),
        sa.Column("auto_approve_existing_documents", sa.Boolean(), nullable=False),
        sa.Column("document_validity_check", sa.Boolean(), nullable=False),
        sa.Column("escalation_enabled", sa.Boolean(), nullable=False),
        sa.Column("auto_escalate_alerts", sa.Boolean(), nullable=False),
        sa.Column("token_expiry_hours", sa.Integer(), nullable=False),
        sa.Column("allow_professional_self_service", sa.Boolean(), nullable=False),
        sa.Column("notify_on_submission", sa.Boolean(), nullable=False),
        sa.Column("notify_on_expiration", sa.Boolean(), nullable=False),
        sa.Column("organization_id", sa.Uuid(), nullable=False),
        sa.ForeignKeyConstraint(
            ["organization_id"],
            ["organizations.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "organization_id", name="uq_organization_screening_settings_org_id"
        ),
    )
    op.create_table(
        "units",
        sa.Column("deleted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column("verified_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("verified_by", sa.Uuid(), nullable=True),
        sa.Column(
            "address", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True
        ),
        sa.Column("number", sqlmodel.sql.sqltypes.AutoString(length=20), nullable=True),
        sa.Column(
            "complement", sqlmodel.sql.sqltypes.AutoString(length=100), nullable=True
        ),
        sa.Column(
            "neighborhood", sqlmodel.sql.sqltypes.AutoString(length=100), nullable=True
        ),
        sa.Column("city", sqlmodel.sql.sqltypes.AutoString(length=100), nullable=True),
        sa.Column(
            "state_code", sqlmodel.sql.sqltypes.AutoString(length=2), nullable=True
        ),
        sa.Column(
            "postal_code", sqlmodel.sql.sqltypes.AutoString(length=10), nullable=True
        ),
        sa.Column("latitude", sa.Float(), nullable=True),
        sa.Column("longitude", sa.Float(), nullable=True),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
        sa.Column("code", sqlmodel.sql.sqltypes.AutoString(length=50), nullable=True),
        sa.Column(
            "description", sqlmodel.sql.sqltypes.AutoString(length=1000), nullable=True
        ),
        sa.Column(
            "unit_type",
            sa.Enum(
                "HOSPITAL",
                "CLINIC",
                "UPA",
                "UBS",
                "EMERGENCY_ROOM",
                "LABORATORY",
                "HOME_CARE",
                "SURGERY_CENTER",
                "DIALYSIS_CENTER",
                "IMAGING_CENTER",
                "MATERNITY",
                "REHABILITATION",
                "OTHER",
                name="unit_type",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("email", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True),
        sa.Column("phone", sqlmodel.sql.sqltypes.AutoString(length=20), nullable=True),
        sa.Column("geofence_radius_meters", sa.Integer(), nullable=True),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("organization_id", sa.Uuid(), nullable=False),
        sa.Column("company_id", sa.Uuid(), nullable=True),
        sa.ForeignKeyConstraint(
            ["company_id"],
            ["companies.id"],
        ),
        sa.ForeignKeyConstraint(
            ["organization_id"],
            ["organizations.id"],
        ),
        sa.ForeignKeyConstraint(
            ["verified_by"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        "ix_units_organization_id", "units", ["organization_id"], unique=False
    )
    op.create_index("ix_units_unit_type", "units", ["unit_type"], unique=False)
    op.create_index(
        "uq_units_org_code",
        "units",
        ["organization_id", "code"],
        unique=True,
        postgresql_where="code IS NOT NULL AND deleted_at IS NULL",
    )
    op.create_table(
        "bank_accounts",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column("verified_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("verified_by", sa.Uuid(), nullable=True),
        sa.Column(
            "agency", sqlmodel.sql.sqltypes.AutoString(length=10), nullable=False
        ),
        sa.Column(
            "agency_digit", sqlmodel.sql.sqltypes.AutoString(length=2), nullable=True
        ),
        sa.Column(
            "account_number",
            sqlmodel.sql.sqltypes.AutoString(length=20),
            nullable=False,
        ),
        sa.Column(
            "account_digit", sqlmodel.sql.sqltypes.AutoString(length=2), nullable=True
        ),
        sa.Column(
            "account_type",
            sa.Enum("CHECKING", "SAVINGS", name="account_type", create_constraint=True),
            nullable=False,
        ),
        sa.Column(
            "holder_name", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False
        ),
        sa.Column(
            "holder_document",
            sqlmodel.sql.sqltypes.AutoString(length=14),
            nullable=False,
        ),
        sa.Column(
            "pix_key_type",
            sa.Enum(
                "CPF",
                "CNPJ",
                "EMAIL",
                "PHONE",
                "RANDOM",
                name="pix_key_type",
                create_constraint=True,
            ),
            nullable=True,
        ),
        sa.Column(
            "pix_key", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True
        ),
        sa.Column("is_primary", sa.Boolean(), nullable=False),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("bank_id", sa.Uuid(), nullable=False),
        sa.Column("organization_professional_id", sa.Uuid(), nullable=True),
        sa.Column("company_id", sa.Uuid(), nullable=True),
        sa.CheckConstraint(
            "(organization_professional_id IS NOT NULL AND company_id IS NULL) OR (organization_professional_id IS NULL AND company_id IS NOT NULL)",
            name="ck_bank_accounts_owner",
        ),
        sa.ForeignKeyConstraint(
            ["bank_id"],
            ["banks.id"],
        ),
        sa.ForeignKeyConstraint(
            ["company_id"],
            ["companies.id"],
        ),
        sa.ForeignKeyConstraint(
            ["organization_professional_id"],
            ["organization_professionals.id"],
        ),
        sa.ForeignKeyConstraint(
            ["verified_by"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "bank_id",
            "agency",
            "account_number",
            "company_id",
            name="uq_bank_accounts_company_account",
        ),
        sa.UniqueConstraint(
            "bank_id",
            "agency",
            "account_number",
            "organization_professional_id",
            name="uq_bank_accounts_org_professional_account",
        ),
    )
    op.create_index(
        "uq_bank_accounts_company_primary",
        "bank_accounts",
        ["company_id"],
        unique=True,
        postgresql_where="is_primary = true AND company_id IS NOT NULL",
    )
    op.create_index(
        "uq_bank_accounts_org_professional_primary",
        "bank_accounts",
        ["organization_professional_id"],
        unique=True,
        postgresql_where="is_primary = true AND organization_professional_id IS NOT NULL",
    )
    op.create_table(
        "professional_companies",
        sa.Column("deleted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column("joined_at", sa.DateTime(timezone=True), nullable=False),
        sa.Column("left_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("organization_professional_id", sa.Uuid(), nullable=False),
        sa.Column("company_id", sa.Uuid(), nullable=False),
        sa.ForeignKeyConstraint(
            ["company_id"],
            ["companies.id"],
        ),
        sa.ForeignKeyConstraint(
            ["organization_professional_id"],
            ["organization_professionals.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "organization_professional_id",
            "company_id",
            name="uq_professional_companies_org_professional_company",
        ),
    )
    op.create_table(
        "professional_qualifications",
        sa.Column("deleted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("verified_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("verified_by", sa.Uuid(), nullable=True),
        sa.Column(
            "professional_type",
            sa.Enum(
                "DOCTOR",
                "NURSE",
                "NURSING_TECH",
                "PHARMACIST",
                "DENTIST",
                "PHYSIOTHERAPIST",
                "PSYCHOLOGIST",
                "NUTRITIONIST",
                "BIOMEDIC",
                name="professional_type",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("is_primary", sa.Boolean(), nullable=False),
        sa.Column("graduation_year", sa.Integer(), nullable=True),
        sa.Column(
            "council_type",
            sa.Enum(
                "CRM",
                "COREN",
                "CRF",
                "CRO",
                "CREFITO",
                "CRP",
                "CRN",
                "CRBM",
                name="council_type",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column(
            "council_number",
            sqlmodel.sql.sqltypes.AutoString(length=20),
            nullable=False,
        ),
        sa.Column(
            "council_state", sqlmodel.sql.sqltypes.AutoString(length=2), nullable=False
        ),
        sa.Column("organization_id", sa.Uuid(), nullable=False),
        sa.Column("organization_professional_id", sa.Uuid(), nullable=False),
        sa.ForeignKeyConstraint(
            ["organization_id"],
            ["organizations.id"],
        ),
        sa.ForeignKeyConstraint(
            ["organization_professional_id"],
            ["organization_professionals.id"],
        ),
        sa.ForeignKeyConstraint(
            ["verified_by"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "organization_professional_id",
            "professional_type",
            name="uq_professional_qualifications_org_professional_type",
        ),
    )
    op.create_index(
        "idx_professional_qualifications_council",
        "professional_qualifications",
        ["council_type", "council_state"],
        unique=False,
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    # GIN trigram index needs raw SQL for proper operator class
    connection.execute(
        sa.text("""
        CREATE INDEX idx_professional_qualifications_council_trgm ON professional_qualifications
        USING gin (lower(council_number) gin_trgm_ops)
        WHERE deleted_at IS NULL
    """)
    )
    op.create_index(
        "idx_professional_qualifications_org_type",
        "professional_qualifications",
        ["organization_id", "professional_type"],
        unique=False,
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.create_index(
        "idx_professional_qualifications_type",
        "professional_qualifications",
        ["professional_type"],
        unique=False,
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.create_index(
        "uq_professional_qualifications_council_org",
        "professional_qualifications",
        ["organization_id", "council_number", "council_state"],
        unique=True,
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.create_table(
        "professional_versions",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column(
            "version_number",
            sa.Integer(),
            server_default=sa.text("nextval('professional_version_number_seq')"),
            nullable=False,
        ),
        sa.Column(
            "data_snapshot", postgresql.JSONB(astext_type=sa.Text()), nullable=False
        ),
        sa.Column("is_current", sa.Boolean(), nullable=False),
        sa.Column(
            "source_type",
            sa.Enum("DIRECT", "SCREENING", "IMPORT", "API", name="source_type"),
            nullable=False,
        ),
        sa.Column("source_id", sa.Uuid(), nullable=True),
        sa.Column("applied_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("applied_by", sa.Uuid(), nullable=True),
        sa.Column("rejected_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("rejected_by", sa.Uuid(), nullable=True),
        sa.Column(
            "rejection_reason",
            sqlmodel.sql.sqltypes.AutoString(length=2000),
            nullable=True,
        ),
        sa.Column(
            "notes", sqlmodel.sql.sqltypes.AutoString(length=2000), nullable=True
        ),
        sa.Column("organization_id", sa.Uuid(), nullable=False),
        sa.Column("professional_id", sa.Uuid(), nullable=True),
        sa.ForeignKeyConstraint(
            ["organization_id"],
            ["organizations.id"],
        ),
        sa.ForeignKeyConstraint(
            ["professional_id"],
            ["organization_professionals.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        "ix_professional_versions_current",
        "professional_versions",
        ["professional_id", "is_current"],
        unique=False,
        postgresql_where=sa.text("is_current = TRUE"),
    )
    op.create_index(
        "ix_professional_versions_organization_id",
        "professional_versions",
        ["organization_id"],
        unique=False,
    )
    op.create_index(
        "ix_professional_versions_pending",
        "professional_versions",
        ["organization_id"],
        unique=False,
        postgresql_where=sa.text("applied_at IS NULL AND rejected_at IS NULL"),
    )
    op.create_index(
        "ix_professional_versions_professional_id",
        "professional_versions",
        ["professional_id"],
        unique=False,
    )
    op.create_index(
        "ix_professional_versions_source",
        "professional_versions",
        ["source_type", "source_id"],
        unique=False,
    )
    op.create_table(
        "sectors",
        sa.Column("deleted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column("name", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False),
        sa.Column("code", sqlmodel.sql.sqltypes.AutoString(length=50), nullable=True),
        sa.Column(
            "description", sqlmodel.sql.sqltypes.AutoString(length=1000), nullable=True
        ),
        sa.Column("latitude", sa.Float(), nullable=True),
        sa.Column("longitude", sa.Float(), nullable=True),
        sa.Column("geofence_radius_meters", sa.Integer(), nullable=True),
        sa.Column("is_active", sa.Boolean(), nullable=False),
        sa.Column("unit_id", sa.Uuid(), nullable=False),
        sa.ForeignKeyConstraint(
            ["unit_id"],
            ["units.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("ix_sectors_unit_id", "sectors", ["unit_id"], unique=False)
    op.create_index(
        "uq_sectors_unit_code",
        "sectors",
        ["unit_id", "code"],
        unique=True,
        postgresql_where="code IS NOT NULL AND deleted_at IS NULL",
    )
    op.create_table(
        "professional_change_diffs",
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column(
            "field_path", sqlmodel.sql.sqltypes.AutoString(length=500), nullable=False
        ),
        sa.Column(
            "change_type",
            sa.Enum("ADDED", "MODIFIED", "REMOVED", name="change_type"),
            nullable=False,
        ),
        sa.Column("old_value", postgresql.JSONB(astext_type=sa.Text()), nullable=True),
        sa.Column("new_value", postgresql.JSONB(astext_type=sa.Text()), nullable=True),
        sa.Column("version_id", sa.Uuid(), nullable=False),
        sa.ForeignKeyConstraint(
            ["version_id"],
            ["professional_versions.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        "ix_professional_change_diffs_field_path",
        "professional_change_diffs",
        ["field_path"],
        unique=False,
    )
    op.create_index(
        "ix_professional_change_diffs_version_field",
        "professional_change_diffs",
        ["version_id", "field_path"],
        unique=False,
    )
    op.create_index(
        "ix_professional_change_diffs_version_id",
        "professional_change_diffs",
        ["version_id"],
        unique=False,
    )
    op.create_table(
        "professional_contracts",
        sa.Column("deleted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("version", sa.Integer(), server_default="1", nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column(
            "contract_number",
            sqlmodel.sql.sqltypes.AutoString(length=100),
            nullable=True,
        ),
        sa.Column(
            "status",
            sa.Enum(
                "DRAFT",
                "PENDING_SIGNATURES",
                "ACTIVE",
                "SUSPENDED",
                "TERMINATED",
                "EXPIRED",
                name="contract_status",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("hourly_rate", sa.Numeric(precision=10, scale=2), nullable=True),
        sa.Column(
            "currency", sqlmodel.sql.sqltypes.AutoString(length=3), nullable=False
        ),
        sa.Column("start_date", sa.Date(), nullable=True),
        sa.Column("end_date", sa.Date(), nullable=True),
        sa.Column(
            "notes", sqlmodel.sql.sqltypes.AutoString(length=2000), nullable=True
        ),
        sa.Column("organization_professional_id", sa.Uuid(), nullable=False),
        sa.Column("client_contract_id", sa.Uuid(), nullable=True),
        sa.Column("company_id", sa.Uuid(), nullable=True),
        sa.Column("bank_account_id", sa.Uuid(), nullable=True),
        sa.Column("unit_id", sa.Uuid(), nullable=True),
        sa.Column("submitted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("professional_signed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("organization_signed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("terminated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("terminated_by", sa.Uuid(), nullable=True),
        sa.Column(
            "termination_reason",
            sqlmodel.sql.sqltypes.AutoString(length=2000),
            nullable=True,
        ),
        sa.Column("termination_notice_date", sa.Date(), nullable=True),
        sa.ForeignKeyConstraint(
            ["bank_account_id"],
            ["bank_accounts.id"],
        ),
        sa.ForeignKeyConstraint(
            ["client_contract_id"],
            ["client_contracts.id"],
        ),
        sa.ForeignKeyConstraint(
            ["company_id"],
            ["companies.id"],
        ),
        sa.ForeignKeyConstraint(
            ["organization_professional_id"],
            ["organization_professionals.id"],
        ),
        sa.ForeignKeyConstraint(
            ["unit_id"],
            ["units.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        "ix_professional_contracts_client_contract_id",
        "professional_contracts",
        ["client_contract_id"],
        unique=False,
    )
    op.create_index(
        "ix_professional_contracts_org_professional_id",
        "professional_contracts",
        ["organization_professional_id"],
        unique=False,
    )
    op.create_index(
        "ix_professional_contracts_status",
        "professional_contracts",
        ["status"],
        unique=False,
    )
    op.create_index(
        "ix_professional_contracts_unit_id",
        "professional_contracts",
        ["unit_id"],
        unique=False,
    )
    op.create_index(
        "uq_professional_contracts_prof_number",
        "professional_contracts",
        ["organization_professional_id", "contract_number"],
        unique=True,
        postgresql_where="contract_number IS NOT NULL AND deleted_at IS NULL",
    )
    op.create_table(
        "professional_educations",
        sa.Column("deleted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("verified_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("verified_by", sa.Uuid(), nullable=True),
        sa.Column(
            "level",
            sa.Enum(
                "TECHNICAL",
                "UNDERGRADUATE",
                "SPECIALIZATION",
                "MASTERS",
                "DOCTORATE",
                "POSTDOC",
                "COURSE",
                "FELLOWSHIP",
                name="education_level",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column(
            "course_name", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False
        ),
        sa.Column(
            "institution", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False
        ),
        sa.Column("start_year", sa.Integer(), nullable=True),
        sa.Column("end_year", sa.Integer(), nullable=True),
        sa.Column("is_completed", sa.Boolean(), nullable=False),
        sa.Column("workload_hours", sa.Integer(), nullable=True),
        sa.Column(
            "certificate_url",
            sqlmodel.sql.sqltypes.AutoString(length=500),
            nullable=True,
        ),
        sa.Column("notes", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("qualification_id", sa.Uuid(), nullable=False),
        sa.ForeignKeyConstraint(
            ["qualification_id"],
            ["professional_qualifications.id"],
        ),
        sa.ForeignKeyConstraint(
            ["verified_by"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        "idx_professional_educations_completed",
        "professional_educations",
        ["is_completed"],
        unique=False,
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.create_index(
        "idx_professional_educations_level",
        "professional_educations",
        ["level"],
        unique=False,
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    # GIN trigram index needs raw SQL for proper operator class
    connection.execute(
        sa.text("""
        CREATE INDEX idx_professional_educations_search_trgm ON professional_educations
        USING gin ((COALESCE(f_unaccent(lower(course_name)), '') || ' ' || COALESCE(f_unaccent(lower(institution)), '')) gin_trgm_ops)
        WHERE deleted_at IS NULL
    """)
    )
    op.create_table(
        "professional_specialties",
        sa.Column("deleted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("verified_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("verified_by", sa.Uuid(), nullable=True),
        sa.Column("is_primary", sa.Boolean(), nullable=False),
        sa.Column(
            "rqe_number", sqlmodel.sql.sqltypes.AutoString(length=20), nullable=True
        ),
        sa.Column(
            "rqe_state", sqlmodel.sql.sqltypes.AutoString(length=2), nullable=True
        ),
        sa.Column(
            "residency_status",
            sa.Enum(
                "R1",
                "R2",
                "R3",
                "R4",
                "R5",
                "R6",
                "COMPLETED",
                name="residency_status",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column(
            "residency_institution",
            sqlmodel.sql.sqltypes.AutoString(length=255),
            nullable=True,
        ),
        sa.Column(
            "residency_expected_completion",
            sqlmodel.sql.sqltypes.AutoString(),
            nullable=True,
        ),
        sa.Column(
            "certificate_url",
            sqlmodel.sql.sqltypes.AutoString(length=500),
            nullable=True,
        ),
        sa.Column("qualification_id", sa.Uuid(), nullable=False),
        sa.Column("specialty_id", sa.Uuid(), nullable=False),
        sa.ForeignKeyConstraint(
            ["qualification_id"],
            ["professional_qualifications.id"],
        ),
        sa.ForeignKeyConstraint(
            ["specialty_id"],
            ["specialties.id"],
        ),
        sa.ForeignKeyConstraint(
            ["verified_by"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "qualification_id",
            "specialty_id",
            name="uq_professional_specialties_qualification_specialty",
        ),
    )
    op.create_table(
        "contract_amendments",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column("verified_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("verified_by", sa.Uuid(), nullable=True),
        sa.Column("amendment_number", sa.Integer(), nullable=False),
        sa.Column(
            "description", sqlmodel.sql.sqltypes.AutoString(length=2000), nullable=False
        ),
        sa.Column("previous_values", sa.JSON(), nullable=True),
        sa.Column("new_values", sa.JSON(), nullable=True),
        sa.Column("effective_from", sa.Date(), nullable=False),
        sa.Column(
            "notes", sqlmodel.sql.sqltypes.AutoString(length=2000), nullable=True
        ),
        sa.Column("contract_id", sa.Uuid(), nullable=False),
        sa.Column("professional_signed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("organization_signed_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["contract_id"],
            ["professional_contracts.id"],
        ),
        sa.ForeignKeyConstraint(
            ["verified_by"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        "ix_contract_amendments_contract_id",
        "contract_amendments",
        ["contract_id"],
        unique=False,
    )
    op.create_index(
        "ix_contract_amendments_effective_from",
        "contract_amendments",
        ["effective_from"],
        unique=False,
    )
    op.create_index(
        "uq_contract_amendments_contract_number",
        "contract_amendments",
        ["contract_id", "amendment_number"],
        unique=True,
    )
    op.create_table(
        "professional_documents",
        sa.Column("deleted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("verified_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("verified_by", sa.Uuid(), nullable=True),
        sa.Column(
            "document_type",
            sa.Enum(
                "ID_DOCUMENT",
                "PHOTO",
                "CRIMINAL_RECORD",
                "ADDRESS_PROOF",
                "CV",
                "DIPLOMA",
                "CRM_REGISTRATION_CERTIFICATE",
                "CRM_FINANCIAL_CERTIFICATE",
                "CRM_ETHICS_CERTIFICATE",
                "RESIDENCY_CERTIFICATE",
                "SPECIALIST_TITLE",
                "SBA_DIPLOMA",
                "OTHER",
                name="document_type",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column(
            "document_category",
            sa.Enum(
                "PROFILE",
                "QUALIFICATION",
                "SPECIALTY",
                name="document_category",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column(
            "file_url", sqlmodel.sql.sqltypes.AutoString(length=2048), nullable=False
        ),
        sa.Column(
            "file_name", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False
        ),
        sa.Column("file_size", sa.Integer(), nullable=True),
        sa.Column(
            "mime_type", sqlmodel.sql.sqltypes.AutoString(length=100), nullable=True
        ),
        sa.Column("expires_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("notes", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.Column("organization_professional_id", sa.Uuid(), nullable=False),
        sa.Column("qualification_id", sa.Uuid(), nullable=True),
        sa.Column("specialty_id", sa.Uuid(), nullable=True),
        sa.ForeignKeyConstraint(
            ["organization_professional_id"],
            ["organization_professionals.id"],
        ),
        sa.ForeignKeyConstraint(
            ["qualification_id"],
            ["professional_qualifications.id"],
        ),
        sa.ForeignKeyConstraint(
            ["specialty_id"],
            ["professional_specialties.id"],
        ),
        sa.ForeignKeyConstraint(
            ["verified_by"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        "idx_professional_documents_category",
        "professional_documents",
        ["document_category"],
        unique=False,
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.create_index(
        "idx_professional_documents_expires",
        "professional_documents",
        ["expires_at"],
        unique=False,
        postgresql_where=sa.text("deleted_at IS NULL AND expires_at IS NOT NULL"),
    )
    # GIN trigram index needs raw SQL for proper operator class
    connection.execute(
        sa.text("""
        CREATE INDEX idx_professional_documents_filename_trgm ON professional_documents
        USING gin (f_unaccent(lower(file_name)) gin_trgm_ops)
        WHERE deleted_at IS NULL
    """)
    )
    op.create_index(
        "idx_professional_documents_type",
        "professional_documents",
        ["document_type"],
        unique=False,
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.create_table(
        "screening_processes",
        sa.Column("deleted_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column(
            "status",
            sa.Enum(
                "DRAFT",
                "IN_PROGRESS",
                "APPROVED",
                "REJECTED",
                "EXPIRED",
                "CANCELLED",
                name="screening_status",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column(
            "professional_cpf",
            sqlmodel.sql.sqltypes.AutoString(length=11),
            nullable=True,
        ),
        sa.Column(
            "professional_email",
            sqlmodel.sql.sqltypes.AutoString(length=255),
            nullable=True,
        ),
        sa.Column(
            "professional_name",
            sqlmodel.sql.sqltypes.AutoString(length=255),
            nullable=True,
        ),
        sa.Column(
            "professional_phone",
            sqlmodel.sql.sqltypes.AutoString(length=20),
            nullable=True,
        ),
        sa.Column(
            "access_token", sqlmodel.sql.sqltypes.AutoString(length=64), nullable=True
        ),
        sa.Column("access_token_expires_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("expires_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("owner_id", sa.Uuid(), nullable=True),
        sa.Column(
            "rejection_reason",
            sqlmodel.sql.sqltypes.AutoString(length=2000),
            nullable=True,
        ),
        sa.Column(
            "notes", sqlmodel.sql.sqltypes.AutoString(length=2000), nullable=True
        ),
        sa.Column(
            "expected_professional_type",
            sqlmodel.sql.sqltypes.AutoString(length=50),
            nullable=True,
        ),
        sa.Column("expected_specialty_id", sa.Uuid(), nullable=True),
        sa.Column("current_actor_id", sa.Uuid(), nullable=True),
        sa.Column("organization_id", sa.Uuid(), nullable=False),
        sa.Column("organization_professional_id", sa.Uuid(), nullable=True),
        sa.Column("professional_contract_id", sa.Uuid(), nullable=True),
        sa.Column("client_contract_id", sa.Uuid(), nullable=True),
        sa.Column("client_company_id", sa.Uuid(), nullable=True),
        sa.Column("completed_at", sa.DateTime(timezone=True), nullable=True),
        sa.ForeignKeyConstraint(
            ["client_company_id"],
            ["companies.id"],
        ),
        sa.ForeignKeyConstraint(
            ["client_contract_id"],
            ["client_contracts.id"],
        ),
        sa.ForeignKeyConstraint(
            ["organization_id"],
            ["organizations.id"],
        ),
        sa.ForeignKeyConstraint(
            ["organization_professional_id"],
            ["organization_professionals.id"],
        ),
        sa.ForeignKeyConstraint(
            ["professional_contract_id"],
            ["professional_contracts.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        "ix_screening_processes_access_token",
        "screening_processes",
        ["access_token"],
        unique=True,
        postgresql_where="access_token IS NOT NULL",
    )
    op.create_index(
        "ix_screening_processes_client_company",
        "screening_processes",
        ["client_company_id"],
        unique=False,
    )
    op.create_index(
        "ix_screening_processes_current_actor",
        "screening_processes",
        ["current_actor_id"],
        unique=False,
    )
    op.create_index(
        "ix_screening_processes_organization_id",
        "screening_processes",
        ["organization_id"],
        unique=False,
    )
    op.create_index(
        "ix_screening_processes_owner",
        "screening_processes",
        ["owner_id"],
        unique=False,
    )
    op.create_index(
        "ix_screening_processes_professional_id",
        "screening_processes",
        ["organization_professional_id"],
        unique=False,
    )
    op.create_index(
        "ix_screening_processes_status", "screening_processes", ["status"], unique=False
    )
    op.create_index(
        "uq_screening_processes_org_cpf_active",
        "screening_processes",
        ["organization_id", "professional_cpf"],
        unique=True,
        postgresql_where="status NOT IN ('APPROVED', 'REJECTED', 'EXPIRED', 'CANCELLED') AND deleted_at IS NULL AND professional_cpf IS NOT NULL",
    )
    op.create_table(
        "contract_documents",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("verified_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("verified_by", sa.Uuid(), nullable=True),
        sa.Column(
            "file_url", sqlmodel.sql.sqltypes.AutoString(length=2048), nullable=False
        ),
        sa.Column(
            "file_name", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=False
        ),
        sa.Column("file_size", sa.Integer(), nullable=True),
        sa.Column(
            "mime_type", sqlmodel.sql.sqltypes.AutoString(length=100), nullable=True
        ),
        sa.Column(
            "notes", sqlmodel.sql.sqltypes.AutoString(length=1000), nullable=True
        ),
        sa.Column("contract_id", sa.Uuid(), nullable=False),
        sa.Column("amendment_id", sa.Uuid(), nullable=True),
        sa.ForeignKeyConstraint(
            ["amendment_id"],
            ["contract_amendments.id"],
        ),
        sa.ForeignKeyConstraint(
            ["contract_id"],
            ["professional_contracts.id"],
        ),
        sa.ForeignKeyConstraint(
            ["verified_by"],
            ["users.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        "ix_contract_documents_amendment_id",
        "contract_documents",
        ["amendment_id"],
        unique=False,
    )
    op.create_index(
        "ix_contract_documents_contract_id",
        "contract_documents",
        ["contract_id"],
        unique=False,
    )
    op.create_table(
        "screening_client_validation_steps",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("version", sa.Integer(), server_default="1", nullable=False),
        sa.Column("order", sa.Integer(), nullable=False),
        sa.Column(
            "status",
            sa.Enum(
                "PENDING",
                "IN_PROGRESS",
                "COMPLETED",
                "APPROVED",
                "REJECTED",
                "SKIPPED",
                "CORRECTION_NEEDED",
                name="step_status",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("assigned_to", sa.Uuid(), nullable=True),
        sa.Column(
            "review_notes", sqlmodel.sql.sqltypes.AutoString(length=2000), nullable=True
        ),
        sa.Column(
            "rejection_reason",
            sqlmodel.sql.sqltypes.AutoString(length=2000),
            nullable=True,
        ),
        sa.Column("started_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_by", sa.Uuid(), nullable=True),
        sa.Column("reviewed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("reviewed_by", sa.Uuid(), nullable=True),
        sa.Column(
            "outcome",
            sa.Enum(
                "APPROVED",
                "REJECTED",
                name="client_validation_outcome",
                create_constraint=True,
            ),
            nullable=True,
        ),
        sa.Column(
            "notes", sqlmodel.sql.sqltypes.AutoString(length=2000), nullable=True
        ),
        sa.Column(
            "validated_by", sqlmodel.sql.sqltypes.AutoString(length=255), nullable=True
        ),
        sa.Column("validated_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column(
            "step_type",
            sa.Enum(
                "CONVERSATION",
                "PROFESSIONAL_DATA",
                "DOCUMENT_UPLOAD",
                "DOCUMENT_REVIEW",
                "PAYMENT_INFO",
                "SUPERVISOR_REVIEW",
                "CLIENT_VALIDATION",
                name="step_type",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("process_id", sa.Uuid(), nullable=False),
        sa.ForeignKeyConstraint(
            ["process_id"],
            ["screening_processes.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "process_id", name="uq_screening_client_validation_steps_process_id"
        ),
    )
    op.create_index(
        "ix_screening_client_validation_steps_process_id",
        "screening_client_validation_steps",
        ["process_id"],
        unique=False,
    )
    op.create_index(
        "ix_screening_client_validation_steps_status",
        "screening_client_validation_steps",
        ["status"],
        unique=False,
    )
    op.create_table(
        "screening_conversation_steps",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("version", sa.Integer(), server_default="1", nullable=False),
        sa.Column("order", sa.Integer(), nullable=False),
        sa.Column(
            "status",
            sa.Enum(
                "PENDING",
                "IN_PROGRESS",
                "COMPLETED",
                "APPROVED",
                "REJECTED",
                "SKIPPED",
                "CORRECTION_NEEDED",
                name="step_status",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("assigned_to", sa.Uuid(), nullable=True),
        sa.Column(
            "review_notes", sqlmodel.sql.sqltypes.AutoString(length=2000), nullable=True
        ),
        sa.Column(
            "rejection_reason",
            sqlmodel.sql.sqltypes.AutoString(length=2000),
            nullable=True,
        ),
        sa.Column("started_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_by", sa.Uuid(), nullable=True),
        sa.Column("reviewed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("reviewed_by", sa.Uuid(), nullable=True),
        sa.Column(
            "notes", sqlmodel.sql.sqltypes.AutoString(length=4000), nullable=True
        ),
        sa.Column(
            "outcome",
            sa.Enum(
                "PROCEED", "REJECT", name="conversation_outcome", create_constraint=True
            ),
            nullable=True,
        ),
        sa.Column(
            "step_type",
            sa.Enum(
                "CONVERSATION",
                "PROFESSIONAL_DATA",
                "DOCUMENT_UPLOAD",
                "DOCUMENT_REVIEW",
                "PAYMENT_INFO",
                "SUPERVISOR_REVIEW",
                "CLIENT_VALIDATION",
                name="step_type",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("process_id", sa.Uuid(), nullable=False),
        sa.ForeignKeyConstraint(
            ["process_id"],
            ["screening_processes.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "process_id", name="uq_screening_conversation_steps_process_id"
        ),
    )
    op.create_index(
        "ix_screening_conversation_steps_process_id",
        "screening_conversation_steps",
        ["process_id"],
        unique=False,
    )
    op.create_index(
        "ix_screening_conversation_steps_status",
        "screening_conversation_steps",
        ["status"],
        unique=False,
    )
    op.create_table(
        "screening_document_upload_steps",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("version", sa.Integer(), server_default="1", nullable=False),
        sa.Column("order", sa.Integer(), nullable=False),
        sa.Column(
            "status",
            sa.Enum(
                "PENDING",
                "IN_PROGRESS",
                "COMPLETED",
                "APPROVED",
                "REJECTED",
                "SKIPPED",
                "CORRECTION_NEEDED",
                name="step_status",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("assigned_to", sa.Uuid(), nullable=True),
        sa.Column(
            "review_notes", sqlmodel.sql.sqltypes.AutoString(length=2000), nullable=True
        ),
        sa.Column(
            "rejection_reason",
            sqlmodel.sql.sqltypes.AutoString(length=2000),
            nullable=True,
        ),
        sa.Column("started_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_by", sa.Uuid(), nullable=True),
        sa.Column("reviewed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("reviewed_by", sa.Uuid(), nullable=True),
        sa.Column("total_documents", sa.Integer(), nullable=False),
        sa.Column("required_documents", sa.Integer(), nullable=False),
        sa.Column("uploaded_documents", sa.Integer(), nullable=False),
        sa.Column(
            "step_type",
            sa.Enum(
                "CONVERSATION",
                "PROFESSIONAL_DATA",
                "DOCUMENT_UPLOAD",
                "DOCUMENT_REVIEW",
                "PAYMENT_INFO",
                "SUPERVISOR_REVIEW",
                "CLIENT_VALIDATION",
                name="step_type",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("process_id", sa.Uuid(), nullable=False),
        sa.ForeignKeyConstraint(
            ["process_id"],
            ["screening_processes.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "process_id", name="uq_screening_document_upload_steps_process_id"
        ),
    )
    op.create_index(
        "ix_screening_document_upload_steps_process_id",
        "screening_document_upload_steps",
        ["process_id"],
        unique=False,
    )
    op.create_index(
        "ix_screening_document_upload_steps_status",
        "screening_document_upload_steps",
        ["status"],
        unique=False,
    )
    op.create_table(
        "screening_payment_info_steps",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("version", sa.Integer(), server_default="1", nullable=False),
        sa.Column("order", sa.Integer(), nullable=False),
        sa.Column(
            "status",
            sa.Enum(
                "PENDING",
                "IN_PROGRESS",
                "COMPLETED",
                "APPROVED",
                "REJECTED",
                "SKIPPED",
                "CORRECTION_NEEDED",
                name="step_status",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("assigned_to", sa.Uuid(), nullable=True),
        sa.Column(
            "review_notes", sqlmodel.sql.sqltypes.AutoString(length=2000), nullable=True
        ),
        sa.Column(
            "rejection_reason",
            sqlmodel.sql.sqltypes.AutoString(length=2000),
            nullable=True,
        ),
        sa.Column("started_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_by", sa.Uuid(), nullable=True),
        sa.Column("reviewed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("reviewed_by", sa.Uuid(), nullable=True),
        sa.Column("is_pj", sa.Boolean(), nullable=False),
        sa.Column("bank_account_id", sa.Uuid(), nullable=True),
        sa.Column("company_id", sa.Uuid(), nullable=True),
        sa.Column("professional_company_id", sa.Uuid(), nullable=True),
        sa.Column(
            "step_type",
            sa.Enum(
                "CONVERSATION",
                "PROFESSIONAL_DATA",
                "DOCUMENT_UPLOAD",
                "DOCUMENT_REVIEW",
                "PAYMENT_INFO",
                "SUPERVISOR_REVIEW",
                "CLIENT_VALIDATION",
                name="step_type",
            ),
            nullable=False,
        ),
        sa.Column("process_id", sa.Uuid(), nullable=False),
        sa.Column("payment_version_id", sa.Uuid(), nullable=True),
        sa.ForeignKeyConstraint(
            ["payment_version_id"],
            ["professional_versions.id"],
        ),
        sa.ForeignKeyConstraint(
            ["process_id"],
            ["screening_processes.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "process_id", name="uq_screening_payment_info_steps_process_id"
        ),
    )
    op.create_index(
        "ix_screening_payment_info_steps_process_id",
        "screening_payment_info_steps",
        ["process_id"],
        unique=False,
    )
    op.create_index(
        "ix_screening_payment_info_steps_status",
        "screening_payment_info_steps",
        ["status"],
        unique=False,
    )
    op.create_table(
        "screening_professional_data_steps",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("version", sa.Integer(), server_default="1", nullable=False),
        sa.Column("order", sa.Integer(), nullable=False),
        sa.Column(
            "status",
            sa.Enum(
                "PENDING",
                "IN_PROGRESS",
                "COMPLETED",
                "APPROVED",
                "REJECTED",
                "SKIPPED",
                "CORRECTION_NEEDED",
                name="step_status",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("assigned_to", sa.Uuid(), nullable=True),
        sa.Column(
            "review_notes", sqlmodel.sql.sqltypes.AutoString(length=2000), nullable=True
        ),
        sa.Column(
            "rejection_reason",
            sqlmodel.sql.sqltypes.AutoString(length=2000),
            nullable=True,
        ),
        sa.Column("started_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_by", sa.Uuid(), nullable=True),
        sa.Column("reviewed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("reviewed_by", sa.Uuid(), nullable=True),
        sa.Column("professional_id", sa.Uuid(), nullable=True),
        sa.Column("qualification_ids", sa.ARRAY(sa.UUID()), nullable=False),
        sa.Column("specialty_ids", sa.ARRAY(sa.UUID()), nullable=False),
        sa.Column("education_ids", sa.ARRAY(sa.UUID()), nullable=False),
        sa.Column(
            "step_type",
            sa.Enum(
                "CONVERSATION",
                "PROFESSIONAL_DATA",
                "DOCUMENT_UPLOAD",
                "DOCUMENT_REVIEW",
                "PAYMENT_INFO",
                "SUPERVISOR_REVIEW",
                "CLIENT_VALIDATION",
                name="step_type",
            ),
            nullable=False,
        ),
        sa.Column("process_id", sa.Uuid(), nullable=False),
        sa.Column("professional_version_id", sa.Uuid(), nullable=True),
        sa.ForeignKeyConstraint(
            ["process_id"],
            ["screening_processes.id"],
        ),
        sa.ForeignKeyConstraint(
            ["professional_version_id"],
            ["professional_versions.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "process_id", name="uq_screening_professional_data_steps_process_id"
        ),
    )
    op.create_index(
        "ix_screening_professional_data_steps_process_id",
        "screening_professional_data_steps",
        ["process_id"],
        unique=False,
    )
    op.create_index(
        "ix_screening_professional_data_steps_status",
        "screening_professional_data_steps",
        ["status"],
        unique=False,
    )
    op.create_table(
        "screening_supervisor_review_steps",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("version", sa.Integer(), server_default="1", nullable=False),
        sa.Column("order", sa.Integer(), nullable=False),
        sa.Column(
            "status",
            sa.Enum(
                "PENDING",
                "IN_PROGRESS",
                "COMPLETED",
                "APPROVED",
                "REJECTED",
                "SKIPPED",
                "CORRECTION_NEEDED",
                name="step_status",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("assigned_to", sa.Uuid(), nullable=True),
        sa.Column(
            "review_notes", sqlmodel.sql.sqltypes.AutoString(length=2000), nullable=True
        ),
        sa.Column(
            "rejection_reason",
            sqlmodel.sql.sqltypes.AutoString(length=2000),
            nullable=True,
        ),
        sa.Column("started_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_by", sa.Uuid(), nullable=True),
        sa.Column("reviewed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("reviewed_by", sa.Uuid(), nullable=True),
        sa.Column(
            "escalation_reason",
            sqlmodel.sql.sqltypes.AutoString(length=2000),
            nullable=True,
        ),
        sa.Column(
            "supervisor_notes",
            sqlmodel.sql.sqltypes.AutoString(length=2000),
            nullable=True,
        ),
        sa.Column("alert_document_count", sa.Integer(), nullable=False),
        sa.Column(
            "step_type",
            sa.Enum(
                "CONVERSATION",
                "PROFESSIONAL_DATA",
                "DOCUMENT_UPLOAD",
                "DOCUMENT_REVIEW",
                "PAYMENT_INFO",
                "SUPERVISOR_REVIEW",
                "CLIENT_VALIDATION",
                name="step_type",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("process_id", sa.Uuid(), nullable=False),
        sa.ForeignKeyConstraint(
            ["process_id"],
            ["screening_processes.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "process_id", name="uq_screening_supervisor_review_steps_process_id"
        ),
    )
    op.create_index(
        "ix_screening_supervisor_review_steps_process_id",
        "screening_supervisor_review_steps",
        ["process_id"],
        unique=False,
    )
    op.create_index(
        "ix_screening_supervisor_review_steps_status",
        "screening_supervisor_review_steps",
        ["status"],
        unique=False,
    )
    op.create_table(
        "screening_document_review_steps",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("version", sa.Integer(), server_default="1", nullable=False),
        sa.Column("order", sa.Integer(), nullable=False),
        sa.Column(
            "status",
            sa.Enum(
                "PENDING",
                "IN_PROGRESS",
                "COMPLETED",
                "APPROVED",
                "REJECTED",
                "SKIPPED",
                "CORRECTION_NEEDED",
                name="step_status",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("assigned_to", sa.Uuid(), nullable=True),
        sa.Column(
            "review_notes", sqlmodel.sql.sqltypes.AutoString(length=2000), nullable=True
        ),
        sa.Column(
            "rejection_reason",
            sqlmodel.sql.sqltypes.AutoString(length=2000),
            nullable=True,
        ),
        sa.Column("started_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("completed_by", sa.Uuid(), nullable=True),
        sa.Column("reviewed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("reviewed_by", sa.Uuid(), nullable=True),
        sa.Column("total_to_review", sa.Integer(), nullable=False),
        sa.Column("reviewed_count", sa.Integer(), nullable=False),
        sa.Column("approved_count", sa.Integer(), nullable=False),
        sa.Column("rejected_count", sa.Integer(), nullable=False),
        sa.Column("alert_count", sa.Integer(), nullable=False),
        sa.Column(
            "step_type",
            sa.Enum(
                "CONVERSATION",
                "PROFESSIONAL_DATA",
                "DOCUMENT_UPLOAD",
                "DOCUMENT_REVIEW",
                "PAYMENT_INFO",
                "SUPERVISOR_REVIEW",
                "CLIENT_VALIDATION",
                name="step_type",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("process_id", sa.Uuid(), nullable=False),
        sa.Column("upload_step_id", sa.Uuid(), nullable=True),
        sa.ForeignKeyConstraint(
            ["process_id"],
            ["screening_processes.id"],
        ),
        sa.ForeignKeyConstraint(
            ["upload_step_id"],
            ["screening_document_upload_steps.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "process_id", name="uq_screening_document_review_steps_process_id"
        ),
    )
    op.create_index(
        "ix_screening_document_review_steps_process_id",
        "screening_document_review_steps",
        ["process_id"],
        unique=False,
    )
    op.create_index(
        "ix_screening_document_review_steps_status",
        "screening_document_review_steps",
        ["status"],
        unique=False,
    )
    op.create_table(
        "screening_documents",
        sa.Column(
            "created_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=False,
        ),
        sa.Column(
            "updated_at",
            sa.DateTime(timezone=True),
            server_default=sa.text("now()"),
            nullable=True,
        ),
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("created_by", sa.Uuid(), nullable=True),
        sa.Column("updated_by", sa.Uuid(), nullable=True),
        sa.Column(
            "document_category",
            sa.Enum(
                "PROFILE",
                "QUALIFICATION",
                "SPECIALTY",
                name="document_category",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column("is_required", sa.Boolean(), nullable=False),
        sa.Column("order", sa.Integer(), nullable=False),
        sa.Column(
            "description", sqlmodel.sql.sqltypes.AutoString(length=500), nullable=True
        ),
        sa.Column(
            "status",
            sa.Enum(
                "PENDING_UPLOAD",
                "PENDING_REVIEW",
                "APPROVED",
                "REJECTED",
                "ALERT",
                "REUSED",
                "SKIPPED",
                name="screening_document_status",
                create_constraint=True,
            ),
            nullable=False,
        ),
        sa.Column(
            "review_notes", sqlmodel.sql.sqltypes.AutoString(length=2000), nullable=True
        ),
        sa.Column(
            "rejection_reason",
            sqlmodel.sql.sqltypes.AutoString(length=1000),
            nullable=True,
        ),
        sa.Column(
            "alert_reason", sqlmodel.sql.sqltypes.AutoString(length=1000), nullable=True
        ),
        sa.Column(
            "review_history", postgresql.JSONB(astext_type=sa.Text()), nullable=False
        ),
        sa.Column("upload_step_id", sa.Uuid(), nullable=False),
        sa.Column("document_type_config_id", sa.Uuid(), nullable=False),
        sa.Column("professional_document_id", sa.Uuid(), nullable=True),
        sa.Column("uploaded_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("uploaded_by", sa.Uuid(), nullable=True),
        sa.Column("reviewed_at", sa.DateTime(timezone=True), nullable=True),
        sa.Column("reviewed_by", sa.Uuid(), nullable=True),
        sa.ForeignKeyConstraint(
            ["document_type_config_id"],
            ["document_type_configs.id"],
        ),
        sa.ForeignKeyConstraint(
            ["professional_document_id"],
            ["professional_documents.id"],
        ),
        sa.ForeignKeyConstraint(
            ["upload_step_id"],
            ["screening_document_upload_steps.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "upload_step_id",
            "document_type_config_id",
            name="uq_screening_documents_step_doc_config",
        ),
    )
    op.create_index(
        "ix_screening_documents_category",
        "screening_documents",
        ["document_category"],
        unique=False,
    )
    op.create_index(
        "ix_screening_documents_status", "screening_documents", ["status"], unique=False
    )
    op.create_index(
        "ix_screening_documents_upload_step_id",
        "screening_documents",
        ["upload_step_id"],
        unique=False,
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # Get current connection for direct execution
    connection = op.get_bind()

    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(
        "ix_screening_documents_upload_step_id", table_name="screening_documents"
    )
    op.drop_index("ix_screening_documents_status", table_name="screening_documents")
    op.drop_index("ix_screening_documents_category", table_name="screening_documents")
    op.drop_table("screening_documents")
    op.drop_index(
        "ix_screening_document_review_steps_status",
        table_name="screening_document_review_steps",
    )
    op.drop_index(
        "ix_screening_document_review_steps_process_id",
        table_name="screening_document_review_steps",
    )
    op.drop_table("screening_document_review_steps")
    op.drop_index(
        "ix_screening_supervisor_review_steps_status",
        table_name="screening_supervisor_review_steps",
    )
    op.drop_index(
        "ix_screening_supervisor_review_steps_process_id",
        table_name="screening_supervisor_review_steps",
    )
    op.drop_table("screening_supervisor_review_steps")
    op.drop_index(
        "ix_screening_professional_data_steps_status",
        table_name="screening_professional_data_steps",
    )
    op.drop_index(
        "ix_screening_professional_data_steps_process_id",
        table_name="screening_professional_data_steps",
    )
    op.drop_table("screening_professional_data_steps")
    op.drop_index(
        "ix_screening_payment_info_steps_status",
        table_name="screening_payment_info_steps",
    )
    op.drop_index(
        "ix_screening_payment_info_steps_process_id",
        table_name="screening_payment_info_steps",
    )
    op.drop_table("screening_payment_info_steps")
    op.drop_index(
        "ix_screening_document_upload_steps_status",
        table_name="screening_document_upload_steps",
    )
    op.drop_index(
        "ix_screening_document_upload_steps_process_id",
        table_name="screening_document_upload_steps",
    )
    op.drop_table("screening_document_upload_steps")
    op.drop_index(
        "ix_screening_conversation_steps_status",
        table_name="screening_conversation_steps",
    )
    op.drop_index(
        "ix_screening_conversation_steps_process_id",
        table_name="screening_conversation_steps",
    )
    op.drop_table("screening_conversation_steps")
    op.drop_index(
        "ix_screening_client_validation_steps_status",
        table_name="screening_client_validation_steps",
    )
    op.drop_index(
        "ix_screening_client_validation_steps_process_id",
        table_name="screening_client_validation_steps",
    )
    op.drop_table("screening_client_validation_steps")
    op.drop_index("ix_contract_documents_contract_id", table_name="contract_documents")
    op.drop_index("ix_contract_documents_amendment_id", table_name="contract_documents")
    op.drop_table("contract_documents")
    op.drop_index(
        "uq_screening_processes_org_cpf_active",
        table_name="screening_processes",
        postgresql_where="status NOT IN ('APPROVED', 'REJECTED', 'EXPIRED', 'CANCELLED') AND deleted_at IS NULL AND professional_cpf IS NOT NULL",
    )
    op.drop_index("ix_screening_processes_status", table_name="screening_processes")
    op.drop_index(
        "ix_screening_processes_professional_id", table_name="screening_processes"
    )
    op.drop_index("ix_screening_processes_owner", table_name="screening_processes")
    op.drop_index(
        "ix_screening_processes_organization_id", table_name="screening_processes"
    )
    op.drop_index(
        "ix_screening_processes_current_actor", table_name="screening_processes"
    )
    op.drop_index(
        "ix_screening_processes_client_company", table_name="screening_processes"
    )
    op.drop_index(
        "ix_screening_processes_access_token",
        table_name="screening_processes",
        postgresql_where="access_token IS NOT NULL",
    )
    op.drop_table("screening_processes")
    op.drop_index(
        "idx_professional_documents_type",
        table_name="professional_documents",
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    connection.execute(
        sa.text("DROP INDEX IF EXISTS idx_professional_documents_filename_trgm")
    )
    op.drop_index(
        "idx_professional_documents_expires",
        table_name="professional_documents",
        postgresql_where=sa.text("deleted_at IS NULL AND expires_at IS NOT NULL"),
    )
    op.drop_index(
        "idx_professional_documents_category",
        table_name="professional_documents",
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.drop_table("professional_documents")
    op.drop_index(
        "uq_contract_amendments_contract_number", table_name="contract_amendments"
    )
    op.drop_index(
        "ix_contract_amendments_effective_from", table_name="contract_amendments"
    )
    op.drop_index(
        "ix_contract_amendments_contract_id", table_name="contract_amendments"
    )
    op.drop_table("contract_amendments")
    op.drop_table("professional_specialties")
    connection.execute(
        sa.text("DROP INDEX IF EXISTS idx_professional_educations_search_trgm")
    )
    op.drop_index(
        "idx_professional_educations_level",
        table_name="professional_educations",
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.drop_index(
        "idx_professional_educations_completed",
        table_name="professional_educations",
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.drop_table("professional_educations")
    op.drop_index(
        "uq_professional_contracts_prof_number",
        table_name="professional_contracts",
        postgresql_where="contract_number IS NOT NULL AND deleted_at IS NULL",
    )
    op.drop_index(
        "ix_professional_contracts_unit_id", table_name="professional_contracts"
    )
    op.drop_index(
        "ix_professional_contracts_status", table_name="professional_contracts"
    )
    op.drop_index(
        "ix_professional_contracts_org_professional_id",
        table_name="professional_contracts",
    )
    op.drop_index(
        "ix_professional_contracts_client_contract_id",
        table_name="professional_contracts",
    )
    op.drop_table("professional_contracts")
    op.drop_index(
        "ix_professional_change_diffs_version_id",
        table_name="professional_change_diffs",
    )
    op.drop_index(
        "ix_professional_change_diffs_version_field",
        table_name="professional_change_diffs",
    )
    op.drop_index(
        "ix_professional_change_diffs_field_path",
        table_name="professional_change_diffs",
    )
    op.drop_table("professional_change_diffs")
    op.drop_index(
        "uq_sectors_unit_code",
        table_name="sectors",
        postgresql_where="code IS NOT NULL AND deleted_at IS NULL",
    )
    op.drop_index("ix_sectors_unit_id", table_name="sectors")
    op.drop_table("sectors")
    op.drop_index("ix_professional_versions_source", table_name="professional_versions")
    op.drop_index(
        "ix_professional_versions_professional_id", table_name="professional_versions"
    )
    op.drop_index(
        "ix_professional_versions_pending",
        table_name="professional_versions",
        postgresql_where=sa.text("applied_at IS NULL AND rejected_at IS NULL"),
    )
    op.drop_index(
        "ix_professional_versions_organization_id", table_name="professional_versions"
    )
    op.drop_index(
        "ix_professional_versions_current",
        table_name="professional_versions",
        postgresql_where=sa.text("is_current = TRUE"),
    )
    op.drop_table("professional_versions")
    op.drop_index(
        "uq_professional_qualifications_council_org",
        table_name="professional_qualifications",
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.drop_index(
        "idx_professional_qualifications_type",
        table_name="professional_qualifications",
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.drop_index(
        "idx_professional_qualifications_org_type",
        table_name="professional_qualifications",
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    connection.execute(
        sa.text("DROP INDEX IF EXISTS idx_professional_qualifications_council_trgm")
    )
    op.drop_index(
        "idx_professional_qualifications_council",
        table_name="professional_qualifications",
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.drop_table("professional_qualifications")
    op.drop_table("professional_companies")
    op.drop_index(
        "uq_bank_accounts_org_professional_primary",
        table_name="bank_accounts",
        postgresql_where="is_primary = true AND organization_professional_id IS NOT NULL",
    )
    op.drop_index(
        "uq_bank_accounts_company_primary",
        table_name="bank_accounts",
        postgresql_where="is_primary = true AND company_id IS NOT NULL",
    )
    op.drop_table("bank_accounts")
    op.drop_index(
        "uq_units_org_code",
        table_name="units",
        postgresql_where="code IS NOT NULL AND deleted_at IS NULL",
    )
    op.drop_index("ix_units_unit_type", table_name="units")
    op.drop_index("ix_units_organization_id", table_name="units")
    op.drop_table("units")
    op.drop_table("organization_screening_settings")
    op.drop_index(
        "uq_organization_professionals_org_email",
        table_name="organization_professionals",
        postgresql_where=sa.text("email IS NOT NULL AND deleted_at IS NULL"),
    )
    op.drop_index(
        "uq_organization_professionals_org_cpf",
        table_name="organization_professionals",
        postgresql_where=sa.text("cpf IS NOT NULL AND deleted_at IS NULL"),
    )
    connection.execute(
        sa.text("DROP INDEX IF EXISTS idx_organization_professionals_search_trgm")
    )
    connection.execute(
        sa.text("DROP INDEX IF EXISTS idx_organization_professionals_full_name_trgm")
    )
    op.drop_index(
        "idx_organization_professionals_created_at",
        table_name="organization_professionals",
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.drop_table("organization_professionals")
    op.drop_table("organization_memberships")
    op.drop_index(
        "ix_document_type_configs_is_active", table_name="document_type_configs"
    )
    op.drop_index(
        "ix_document_type_configs_code_active",
        table_name="document_type_configs",
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.drop_index(
        "ix_document_type_configs_category", table_name="document_type_configs"
    )
    op.drop_table("document_type_configs")
    op.drop_index(
        "uq_client_contracts_org_number",
        table_name="client_contracts",
        postgresql_where="contract_number IS NOT NULL AND deleted_at IS NULL",
    )
    op.drop_index("ix_client_contracts_status", table_name="client_contracts")
    op.drop_index("ix_client_contracts_organization_id", table_name="client_contracts")
    op.drop_table("client_contracts")
    op.drop_table("organizations")
    op.drop_table("user_roles")
    op.drop_table("user_permissions")
    op.drop_table("role_permissions")
    op.drop_table("companies")
    op.drop_table("users")
    op.drop_index(
        "uq_specialties_code",
        table_name="specialties",
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    connection.execute(sa.text("DROP INDEX IF EXISTS idx_specialties_search_trgm"))
    op.drop_index(
        "idx_specialties_name",
        table_name="specialties",
        postgresql_where=sa.text("deleted_at IS NULL"),
    )
    op.drop_table("specialties")
    op.drop_table("roles")
    op.drop_table("permissions")
    op.drop_table("banks")
    # ### end Alembic commands ###

    # Drop sequence (extensions are dropped in the extensions migration)
    connection.execute(
        sa.text("DROP SEQUENCE IF EXISTS professional_version_number_seq")
    )
